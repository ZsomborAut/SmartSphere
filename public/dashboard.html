<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>SmartHome</title>
    <style>
      body 
      {
        margin: 0;
        height: 100vh;
        background-color: black; /* alap h√°tt√©rsz√≠n bet√∂lt√©s k√∂zben */
        background-image: url("images/bckgnd-Modern House.jpg");
        background-size: cover;
        background-position: center 23%;
        background-repeat: no-repeat;
        background-attachment: fixed;
        font-family: Arial, sans-serif;
      }
      body.outside
      {
        margin: 0;
        height: 100vh;
        background-image: url("images/bckgnd-Modern House.jpg");
        background-size: cover;
        background-position: center 23%;
        background-repeat: no-repeat;
        font-family: Arial, sans-serif;
      }

      body.inside
      {
        background-image: url("images/bckg-House Plan.jpg");
        background-size: cover;
        background-position: 60% 40%;
        background-repeat: no-repeat;
      }

      /* K√∂r gomb */
      .btn-circle {
        position: absolute;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        border: 5px solid rgb(0, 0, 100);
        background: radial-gradient(circle at 30% 30%, rgba(0, 255, 255, 0.133), rgba(0, 0, 0, 0.267));
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.333);
        cursor: pointer;
        transition: box-shadow 0.25s ease, transform 0.25s ease, border-color 0.25s ease;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      /* Hoverre csak f√©nyesebb lesz, nem forog */
      .btn-circle:hover {
        box-shadow: 0 0 25px rgba(0, 255, 255, 0.667), 0 0 50px rgba(0, 255, 255, 0.333) inset;
        transform: scale(1.1); /* enyhe nagy√≠t√°s, hogy reag√°ljon */
      }

      /* Ikon a k√∂zep√©n */
      .btn-circle img {
        width: 70%;
        height: 70%;
        object-fit: contain;
        pointer-events: none;
      }

      /* Tooltip (felirat) */
      .btn-circle span {
        position: absolute;
        left: auto;
        right: 50px;
        top: 50%;
        transform: translateY(-50%) translateX(-10px);
        color: rgb(0, 255, 255);
        font-size: 16px;
        background: rgb(0, 0, 0);
        padding: 4px 10px;
        border-radius: 8px;
        opacity: 0;
        transition: opacity 0.25s ease, transform 0.25s ease;
        pointer-events: none;
        white-space: nowrap;
      }

      /* Hoverkor megjelenik a felirat */
      .btn-circle:hover span {
        opacity: 1;
        transform: translateY(-50%) translateX(0);
      }

      .hidden
      {
        display: none;
      }

      .btn-circle.tooltip-left span 
      {
        left: 60px;
        right: auto;
        transform: translateY(-50%) translateX(-10px);
      }

      #Settings { top: 1%; right: 1%; }
      #Garage { top: 55%; right: 16%; }
      #Entrence { top: 54%; right: 48.5%; }
      #Watering { bottom: 10%; right: 35%; }
      #Roller_Shutter { top: 35%; right: 48.5% }
      #Gate { bottom: 10%; left: 9% }
      #Security { top: 10%; right: 48.5% }
      #External_Lighting { bottom: 25.5%; left: 25% }

      /* I N T E R I O R */

      /*Lighting*/
      #Living_Lighting {top: 35%; left: 65%}
      #Bedroom03_Lighting {bottom: 25%; left: 53%}
      #Bedroom04_Lighting {bottom: 25%; left: 30%}
      #Kitchen_Lighting {top: 30%; left: 55%}
      #Bathroom_Lighting {bottom: 22%; left: 41%}
      #Toalett_Lighting {bottom: 42%; left: 43%}
      #Garage_Lighting {top: 28%; left: 25%}

      #Back { bottom: 2%; left: 1% }

      /* vil√°g√≠t√≥ √°llapot st√≠lusa ‚Äì nagyobb f√©nyk√∂rrel */
      .btn-circle.active {
        border-color: rgb(0, 200, 0);
        box-shadow: 
          0 0 35px rgba(0, 255, 0, 0.8),      /* er≈ësebb k√∂zeli f√©ny */
          0 0 50px rgba(0, 255, 0, 0.5) inset,/* bels≈ë ragyog√°s */
          0 0 120px rgba(0, 255, 0, 0.4),     /* k√ºls≈ë f√©ny */
          0 0 200px rgba(0, 255, 0, 0.25);    /* t√°volabbra sz√≥rt halv√°ny f√©ny */
      }
    </style>
  </head>
  <body>
    <div class="btn-circle" id="Settings">
      <img src="images/Settings.png" alt="Settings">
      <span>Settings</span>
    </div>

    <div class="btn-circle" id="Garage">
      <img src="images/Garage.png" alt="Garage">
      <span>Garage</span>
    </div>

    <div class="btn-circle" id="Entrence">
      <img src="images/Entrence.png" alt="Entrence">
      <span>Entrence</span>
    </div>

    <div class="btn-circle" id="Watering">
      <img src="images/Watering.png" alt="Watering">
      <span>Watering</span>
    </div>

    <div class="btn-circle" id="Roller_Shutter">
      <img src="images/Roller_Shutter.png" alt="RollerShutter">
      <span>Roller Shutter</span>
    </div>

    <div class="btn-circle" id="Gate">
      <img src="images/Gate.png" alt="Gate">
      <span>Gate</span>
    </div>

    <div class="btn-circle" id="Security">
      <img src="images/Security.png" alt="Security">
      <span>Security</span>
    </div>

    <div class="btn-circle" id="External_Lighting">
      <img src="images/Light.png" alt="ExternalLighting">
      <span>External Lighting</span>
    </div>

    <div class="btn-circle hidden tooltip-left" id="Back">
      <img src="images/Back.png" alt="Back">
      <span>Back</span>
    </div>

    <div class="btn-circle hidden tooltip-left" id="Living_Lighting">
      <img src="images/Light.png" alt="Living_Lighting">
      <span>Living Lighting</span>
    </div>

    <div class="btn-circle hidden tooltip-left" id="Bedroom03_Lighting">     <!--Innen kell vegyem a mintat-->
      <img src="images/Light.png" alt="Bedroom03_Lighting">
      <span>Bedroom03 Lighting</span>
    </div>

    <!--Innen irtam-->
    <div class="btn-circle hidden tooltip-left" id="Bedroom04_Lighting">     
      <img src="images/Light.png" alt="Bedroom04_Lighting">
      <span>Bedroom04 Lighting</span>
    </div>

    <div class="btn-circle hidden tooltip-left" id="Kitchen_Lighting">     
      <img src="images/Light.png" alt="Kitchen_Lighting">
      <span>Kitchen Lighting</span>
    </div>

    <div class="btn-circle hidden tooltip-left" id="Bathroom_Lighting">     
      <img src="images/Light.png" alt="Bathroom_Lighting">
      <span>Bathroom Lighting</span>
    </div>

    <div class="btn-circle hidden tooltip-left" id="Garage_Lighting">     
      <img src="images/Light.png" alt="Garage_Lighting">
      <span>Garage Lighting</span>
    </div>

    <div class="btn-circle hidden tooltip-left" id="Toalett_Lighting">     
      <img src="images/Light.png" alt="Toalett_Lighting">
      <span>Toalett Lighting</span>
    </div>

    <!--Idaig-->


    <script>
      const Settings = document.getElementById("Settings");
      const Garage = document.getElementById("Garage");
      const Entrence = document.getElementById("Entrence");
      const Watering = document.getElementById("Watering");
      const Roller_Shutter = document.getElementById("Roller_Shutter");
      const Gate = document.getElementById("Gate");
      const Security = document.getElementById("Security");
      const External_Lighting = document.getElementById("External_Lighting");
      const Back = document.getElementById("Back");
      const Living_Lighting = document.getElementById("Living_Lighting");
      const Bedroom03_Lighting = document.getElementById("Bedroom03_Lighting");
      const Bedroom04_Lighting = document.getElementById("Bedroom04_Lighting"); //Ezt adtam hozza
      const Kitchen = document.getElementById("Kitchen_Lighting"); //Ezt adtam hozza
      const Bathroom = document.getElementById("Bathroom_Lighting"); //Ezt adtam hozza
      const Garage_Lighting = document.getElementById("Garage_Lighting"); //Ezt adtam hozza
      const Toalett = document.getElementById("Toalett_Lighting"); //Ezt adtam hozza

      const toggleButtons = [Garage, Watering, Roller_Shutter, Gate, Security, External_Lighting, Living_Lighting, Bedroom03_Lighting, Bedroom04_Lighting, Kitchen_Lighting, Bathroom_Lighting, Garage_Lighting, Toalett_Lighting];
      toggleButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          btn.classList.toggle("active");
        });
      });

      Entrence.addEventListener
      ("click", () => 
      {
        document.body.classList.remove("outside");
        document.body.classList.add("inside");

        // Hide old button
        Garage.classList.add("hidden");
        Entrence.classList.add("hidden");
        Watering.classList.add("hidden");
        Roller_Shutter.classList.add("hidden");
        Gate.classList.add("hidden");
        Security.classList.add("hidden");
        External_Lighting.classList.add("hidden");

        // Show new buttons
        Living_Lighting.classList.remove("hidden");
        Bedroom03_Lighting.classList.remove("hidden");
        Bedroom04_Lighting.classList.remove("hidden"); //Ezt adtam hozza
        Kitchen.classList.remove("hidden"); //Ezt adtam hozza
        Bathroom.classList.remove("hidden"); //Ezt adtam hozza
        Garage_Lighting.classList.remove("hidden"); //Ezt adtam hozza
        Toalett.classList.remove("hidden"); //Ezt adtam hozza
        Back.classList.remove("hidden");
      });

      // We go back to the Exterior view
      Back.addEventListener
      ("click", () => 
      {
        document.body.classList.remove("inside");
        document.body.classList.add("outside");
        
        // Hide old buttons
        Back.classList.add("hidden");
        Living_Lighting.classList.add("hidden");
        Bedroom03_Lighting.classList.add("hidden"); 
        Bedroom04_Lighting.classList.add("hidden"); //Ezt adtam hozza
        Kitchen.classList.add("hidden"); //Ezt adtam hozza
        Bathroom.classList.add("hidden"); //Ezt adtam hozza
        Garage_Lighting.classList.add("hidden"); //Ezt adtam hozza
        Toalett.classList.add("hidden"); //Ezt adtam hozza
        

        // Show new buttons
        Garage.classList.remove("hidden");
        Entrence.classList.remove("hidden");
        Watering.classList.remove("hidden");
        Roller_Shutter.classList.remove("hidden");
        Gate.classList.remove("hidden");
        Security.classList.remove("hidden");
        External_Lighting.classList.remove("hidden");
      });
    </script>

    
    <style>
      /* --- h√°tt√©r √©s panel --- */
      .settings-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        place-items: center;
        z-index: 1000;
      }
      .settings-backdrop.show { display: grid; }

      .settings-modal {
        position: relative;
        background: #ffffff;
        color: #0f172a;
        padding: 16px;
        border-radius: 12px;
        width: 340px;
        max-height: 90vh;
        overflow: auto;
        box-shadow: 0 8px 24px rgba(0,0,0,0.24);
        transition: background 0.2s ease, color 0.2s ease;
      }
      .settings-close {
        position: absolute;
        top: 8px; right: 8px;
        background: none; border: 0;
        font-size: 20px; cursor: pointer;
      }
      .settings-row {
        margin-top: 10px;
        display: flex; gap: 10px;
        align-items: center;
      }
      html[data-theme="dark"] .settings-modal {
        background: #0f172a;
        color: #e5e7eb;
        border: 1px solid #1f2937;
        box-shadow: 0 8px 24px rgba(0,0,0,.6);
      }
      .hr { height: 1px; background: #e5e7eb; margin: 12px 0; }
      html[data-theme="dark"] .hr { background: #1f2937; }

      /* --- cs√∫szka --- */
      .switch { position: relative; display: inline-block; width: 50px; height: 26px; }
      .switch input { opacity: 0; width: 0; height: 0; }
      .slider { position: absolute; inset: 0; cursor: pointer; background-color: #f87171; border-radius: 26px; transition: 0.3s; }
      .slider::before { content: ""; position: absolute; height: 20px; width: 20px; left: 3px; bottom: 3px; background: #fff; border-radius: 50%; transition: 0.3s; }
      .switch input:checked + .slider { background-color: #4ade80; }
      .switch input:checked + .slider::before { transform: translateX(24px); }

      /* --- gombok --- */
      .btn {
        display: inline-flex; align-items: center; justify-content: center;
        gap: 6px; border: 1px solid #e5e7eb; padding: 6px 10px; border-radius: 8px;
        background: #f8fafc; color: #0f172a; cursor: pointer; font-weight: 600; font-size: 14px;
        transition: background .2s, border-color .2s, transform .05s;
      }
      .btn:hover { background: #f1f5f9; }
      .btn:active { transform: translateY(1px); }
      html[data-theme="dark"] .btn { background: #0b1220; color: #e5e7eb; border-color: #1f2937; }
      html[data-theme="dark"] .btn:hover { background: #0e1729; }

      .btn-danger { color: #dc2626; border-color: #fecaca; background: #fff1f2; }
      .btn-danger:hover { background: #ffe4e6; }
      html[data-theme="dark"] .btn-danger { color: #fca5a5; border-color: #7f1d1d; background: #1b0b0b; }
      html[data-theme="dark"] .btn-danger:hover { background: #260f0f; }

      /* --- Preset lista --- */
      .preset-header { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
      .preset-list { display: grid; gap: 8px; margin-top: 8px; }
      .preset-item {
        display: grid; grid-template-columns: 1fr auto auto auto; align-items: center; gap: 8px;
        padding: 8px; border: 1px solid #e5e7eb; border-radius: 10px; background: #ffffff;
      }
      html[data-theme="dark"] .preset-item { border-color: #1f2937; background: #0b1220; }
      .preset-name { font-weight: 600; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
      .icon-btn { background: none; border: 0; cursor: pointer; font-size: 16px; padding: 4px; }
      .icon-btn[title="Szerkeszt√©s"] { color: #2563eb; }
      .icon-btn[title="T√∂rl√©s"] { color: #dc2626; }

      /* --- szerkeszt≈ë panel --- */
      .editor { margin-top: 10px; padding: 10px; border: 1px dashed #cbd5e1; border-radius: 10px; display: none; }
      html[data-theme="dark"] .editor { border-color: #334155; }
      .editor.show { display: block; }
      .editor-grid { display: grid; gap: 12px; }
      .editor-row { display: grid; gap: 8px; }
      .editor-group { border: 1px solid #e5e7eb; border-radius: 8px; padding: 8px; }
      html[data-theme="dark"] .editor-group { border-color: #1f2937; }
      .group-title { font-weight: 700; margin-bottom: 6px; }
      .toggle-row { display: flex; align-items: center; justify-content: space-between; padding: 6px 0; }
      .field {
        display: grid; gap: 6px;
      }
      .input { padding: 8px 10px; border: 1px solid #e5e7eb; border-radius: 8px; background: #fff; color: inherit; }
      html[data-theme="dark"] .input { background: #0b1220; border-color: #1f2937; color: #e5e7eb; }

      /* --- logout --- */
      .logout-row { margin-top: 16px; padding-top: 10px; border-top: 1px solid #e5e7eb; text-align: center; }
      .logout-btn { color: #dc2626; font-weight: 600; cursor: pointer; border: none; background: none; font-size: 15px; transition: color 0.2s; }
      .logout-btn:hover { color: #b91c1c; }
    </style>
  </head>

  <body>
    <div id="settingsBackdrop" class="settings-backdrop">
      <div class="settings-modal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
        <button id="settingsClose" class="settings-close" aria-label="Bez√°r√°s">√ó</button>

        <!-- T√©ma -->
        <div class="settings-row" role="group" aria-label="Theme">
          <strong>Theme:</strong>
          <label><input type="radio" name="theme" value="light" checked> Light</label>
          <label><input type="radio" name="theme" value="dark"> Dark</label>
        </div>

        <div class="hr"></div>

        <!-- Presetek -->
        <div class="preset-header">
          <strong>Presets</strong>
          <button id="addPreset" class="btn">Ôºã New preset</button>
        </div>
        <div id="presetList" class="preset-list" aria-live="polite"></div>

        <!-- Szerkeszt≈ë -->
        <div id="presetEditor" class="editor" aria-live="polite">
          <div class="editor-grid">
            <div class="field">
              <label for="presetName"><strong>Preset name</strong></label>
              <input id="presetName" class="input" type="text" placeholder="E.g. Morning routine" maxlength="40" />
            </div>

            <div class="editor-group">
              <div class="group-title">Outdoor equipment</div>
              <div class="toggle-row"><span>Gate</span> <label class="switch"><input data-key="Gate" type="checkbox"><span class="slider"></span></label></div>
              <div class="toggle-row"><span>External Lighting</span> <label class="switch"><input data-key="External Lighting" type="checkbox"><span class="slider"></span></label></div>
              <div class="toggle-row"><span>Watering</span> <label class="switch"><input data-key="Watering" type="checkbox"><span class="slider"></span></label></div>
              <div class="toggle-row"><span>Garage</span> <label class="switch"><input data-key="Garage" type="checkbox"><span class="slider"></span></label></div>
              <div class="toggle-row"><span>Roller Shutter</span> <label class="switch"><input data-key="Roller Shutter" type="checkbox"><span class="slider"></span></label></div>
              <div class="toggle-row"><span>Security</span> <label class="switch"><input data-key="Security" type="checkbox"><span class="slider"></span></label></div>
              <div class="toggle-row"><span>Garage door</span> <label class="switch"><input data-key="Garage door" type="checkbox"><span class="slider"></span></label></div>
            </div>

            <div class="editor-group">
              <div class="group-title">Indoor lighting</div>
              <div class="toggle-row"><span>Bedroom03</span> <label class="switch"><input data-key="Bedroom03" type="checkbox"><span class="slider"></span></label></div>
              <div class="toggle-row"><span>Bedroom04</span> <label class="switch"><input data-key="Bedroom04" type="checkbox"><span class="slider"></span></label></div>
              <div class="toggle-row"><span>Living room</span> <label class="switch"><input data-key="Living room" type="checkbox"><span class="slider"></span></label></div>
              <div class="toggle-row"><span>Kitchen</span> <label class="switch"><input data-key="Kitchen" type="checkbox"><span class="slider"></span></label></div>
              <div class="toggle-row"><span>Garage</span> <label class="switch"><input data-key="Garage (inside)" type="checkbox"><span class="slider"></span></label></div>
              <div class="toggle-row"><span>Bathroom</span> <label class="switch"><input data-key="Bathroom" type="checkbox"><span class="slider"></span></label></div>
              <div class="toggle-row"><span>Toalett</span> <label class="switch"><input data-key="Toalett" type="checkbox"><span class="slider"></span></label></div>
            </div>

            <div style="display:flex; gap:8px; justify-content:flex-end;">
              <button id="cancelEdit" class="btn">Cancel</button>
              <button id="savePreset" class="btn">üíæ Save</button>
            </div>
          </div>
        </div>

        <!-- Logout -->
        <div class="logout-row">
          <button id="logoutBtn" class="logout-btn">Log out</button>
        </div>
      </div>
    </div>

    <script>
      // ===== Elem hivatkoz√°sok =====
      const backdrop = document.getElementById('settingsBackdrop');
      const closeBtn = document.getElementById('settingsClose');
      const settingsBtn = document.getElementById('Settings'); // jobb fels≈ë fogasker√©k
      const themeRadios = document.querySelectorAll('input[name="theme"]');

      const presetList = document.getElementById('presetList');
      const addPresetBtn = document.getElementById('addPreset');

      const editor = document.getElementById('presetEditor');
      const presetNameInput = document.getElementById('presetName');
      const savePresetBtn = document.getElementById('savePreset');
      const cancelEditBtn = document.getElementById('cancelEdit');

      const logoutBtn = document.getElementById('logoutBtn');

      // Editor √°llapot
      let editingId = null; // null = √∫j preset

      // Alap kulcsok (fel√ºlethez k√∂tve data-key alapj√°n)
      function allDeviceKeys() {
        return Array.from(editor.querySelectorAll('input[type="checkbox"][data-key]')).map(i => i.getAttribute('data-key'));
      }

      // ===== Modal megnyit√°s / z√°r√°s =====
      settingsBtn && settingsBtn.addEventListener('click', () => {
        backdrop.classList.add('show');
        renderPresetList();
      });
      closeBtn.addEventListener('click', () => backdrop.classList.remove('show'));
      backdrop.addEventListener('click', e => { if (e.target === backdrop) backdrop.classList.remove('show'); });

      // ===== T√©ma v√°lt√°s =====
      themeRadios.forEach(radio => {
        radio.addEventListener('change', e => {
          document.documentElement.setAttribute('data-theme', e.target.value);
          localStorage.setItem('theme', e.target.value);
        });
      });

      // ===== Preset CRUD a localStorage-ben =====
      const LS_KEY = 'userPresets';
      const LS_ACTIVE = 'activePresetId';

      function loadPresets() {
        try { return JSON.parse(localStorage.getItem(LS_KEY) || '[]'); } catch { return []; }
      }
      function savePresets(list) {
        localStorage.setItem(LS_KEY, JSON.stringify(list));
      }
      function activePresetId() { return localStorage.getItem(LS_ACTIVE) || null; }
      function setActivePresetId(id) { if (id === null) localStorage.removeItem(LS_ACTIVE); else localStorage.setItem(LS_ACTIVE, id); }

      function ensureDefaults() {
        // Ha nincs semmi, l√©trehozunk k√©t mint√°t, hogy legyen mit l√°tni
        const items = loadPresets();
        if (items.length === 0) {
          const keys = allDeviceKeys();
          const sample1 = { id: crypto.randomUUID(), name: 'Reggel', devices: Object.fromEntries(keys.map(k => [k, false])) };
          const sample2 = { id: crypto.randomUUID(), name: 'Este', devices: Object.fromEntries(keys.map(k => [k, false])) };
          // P√©lda: este k√ºls≈ë vil√°g√≠t√°s √©s Security bekapcsolva
          sample2.devices['External Lighting'] = true;
          sample2.devices['Security'] = true;
          savePresets([sample1, sample2]);
          setActivePresetId(sample2.id);
        }
      }

      // ===== Lista render =====
      function renderPresetList() {
       ///ensureDefaults();
        const items = loadPresets();
        const activeId = activePresetId();
        if (items.length === 0) { presetList.innerHTML = '<em>There are no presets yet. Click on the "New preset" button!.</em>'; return; }
        presetList.innerHTML = '';
        for (const p of items) {
          const row = document.createElement('div');
          row.className = 'preset-item';
          row.dataset.id = p.id;
          row.innerHTML = `
            <div class="preset-name" title="${p.name}">${p.name}</div>
            <label class="switch" title="Activation">
              <input type="checkbox" ${p.id === activeId ? 'checked' : ''} aria-label="Activation">
              <span class="slider"></span>
            </label>
            <button class="icon-btn" title="Edit">‚úé</button>
            <button class="icon-btn" title="Delete">üóë</button>
          `;
          presetList.appendChild(row);
        }
      }

      // ===== Preset szerkeszt≈ë =====
      function openEditor(preset) {
        editingId = preset ? preset.id : null;
        // N√©v
        presetNameInput.value = preset ? preset.name : '';
        // Kapcsol√≥k
        const allKeys = allDeviceKeys();
        const devices = preset ? preset.devices : Object.fromEntries(allKeys.map(k => [k, false]));
        for (const input of editor.querySelectorAll('input[type="checkbox"][data-key]')) {
          const key = input.getAttribute('data-key');
          input.checked = !!devices[key];
        }
        editor.classList.add('show');
        presetNameInput.focus();
      }

      function closeEditor() {
        editor.classList.remove('show');
        editingId = null;
      }

      function collectEditorData() {
        const name = (presetNameInput.value || '').trim();
        const devices = {};
        for (const input of editor.querySelectorAll('input[type="checkbox"][data-key]')) {
          devices[input.getAttribute('data-key')] = input.checked;
        }
        return { name, devices };
      }

      // ===== Esem√©nyek =====
      addPresetBtn.addEventListener('click', () => openEditor(null));
      cancelEditBtn.addEventListener('click', closeEditor);

      savePresetBtn.addEventListener('click', () => {
        const { name, devices } = collectEditorData();
        if (!name) { alert('Give the preset a name!'); return; }
        const list = loadPresets();
        if (editingId) {
          const idx = list.findIndex(p => p.id === editingId);
          if (idx !== -1) list[idx] = { ...list[idx], name, devices };
        } else {
          list.push({ id: crypto.randomUUID(), name, devices });
        }
        savePresets(list);
        renderPresetList();
        closeEditor();
      });

      // Lista gombjai (deleg√°ci√≥)
      presetList.addEventListener('click', (e) => {
        const row = e.target.closest('.preset-item');
        if (!row) return;
        const id = row.dataset.id;
        const list = loadPresets();
        const preset = list.find(p => p.id === id);

        // Aktiv√°l√°s kapcsol√≥
        if (e.target.matches('input[type="checkbox"]')) {
          const checked = e.target.checked;
          // Csak egy lehet akt√≠v: ha bekapcsoljuk, a t√∂bbir≈ël levessz√ºk
          if (checked) {
            setActivePresetId(id);
            // Itt lehet k√ºls≈ë rendszert √©rtes√≠teni:
            dispatchPresetApplied(preset);
          } else {
            setActivePresetId(null);
          }
          renderPresetList();
          return;
        }

        // Szerkeszt√©s
        if (e.target.matches('.icon-btn[title="Edit"]')) {
          openEditor(preset);
          return;
        }

        // T√∂rl√©s
        if (e.target.matches('.icon-btn[title="Delete"]')) {
          if (confirm('Are you sure you want to delete the preset?')) {
            const newList = list.filter(p => p.id !== id);
            savePresets(newList);
            if (activePresetId() === id) setActivePresetId(null);
            renderPresetList();
          }
          return;
        }
      });

      // Egys√©ges √©rtes√≠t√©s ‚Äì itt k√∂theted be a val√≥di vez√©rl√©st
      function dispatchPresetApplied(preset) {
        const event = new CustomEvent('presetApplied', { detail: { preset } });
        window.dispatchEvent(event);
        // P√©lda: konzolra ki√≠rjuk az √°llapotot
        console.log('Preset applied:', preset.name, preset.devices);
      }

      // ===== Log out gomb =====
      logoutBtn.addEventListener('click', () => {
        if (confirm('Are you sure you want to log out?')) {
          // Ha csak a user adatokat akarod t√∂r√∂lni, azokat c√©lozd ‚Äì itt most minden be√°ll√≠t√°st √ºr√≠t√ºnk
          localStorage.clear();
          alert('You have successfully logged out!');
          renderPresetList();
        }
      });

      // ===== Indul√≥ be√°ll√≠t√°s =====
      (function init() {
        const theme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', theme);
        const themeRadio = document.querySelector(`input[name="theme"][value="${theme}"]`);
        if (themeRadio) themeRadio.checked = true;
        renderPresetList();
      })();
    </script>
    
  </body>
</html>